<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glex</title>
    <link rel="stylesheet" href="style.css">
    <script>
        (function(){
            try {
                const origCreate = document.createTextNode;
                document.createTextNode = function(text){
                    try {
                        if (String(text).trim().toLowerCase() === 'div') {
                            console.warn('Sanitizer: preventing creation of text node "div"');
                            return origCreate.call(document, '');
                        }
                    } catch(e){}
                    return origCreate.call(document, text);
                };
                const wrap = (obj, method) => {
                    const orig = obj[method];
                    obj[method] = function(node){
                        try {
                            if (node && node.nodeType === Node.TEXT_NODE && node.textContent && node.textContent.trim().toLowerCase() === 'div') {
                                        console.warn('Sanitizer: blocking insertion of text node "div" via ' + method);
                                        try { console.trace('Trace: blocked insertion of stray div text node'); } catch(e){}
                                        return node; // skip this crap
                                    }
                        } catch (e) {}
                        return orig.apply(this, arguments);
                    };
                };
                wrap(Node.prototype, 'appendChild');
                wrap(Node.prototype, 'insertBefore');
                wrap(Node.prototype, 'replaceChild');
            } catch (e) { console.error('Diagnostic setup failed', e); }
        })();
        // silence console output for release
        console.log = console.warn = console.error = console.info = function(){};
        console.debug = function(){};
    </script>
    <!-- Uhhh load system binaries ig -->
    <script src="src/vendor/preact.umd.js"></script>
    <script src="src/vendor/hooks.umd.js"></script>
    <script src="src/vendor/htm.umd.js"></script>
    <script src="src/vendor/jszip.js"> </script>
    <script>
        (function () {
            try {
                if (window.preact && window.preactHooks && window.htm) {
                    window.htmPreact = {
                        html: window.htm.bind(window.preact.h),
                        render: window.preact.render,
                        useState: window.preactHooks.useState,
                        useEffect: window.preactHooks.useEffect,
                        useRef: window.preactHooks.useRef,
                        useLayoutEffect: window.preactHooks.useLayoutEffect
                    };
                }
            } catch (e) { console.warn('preact/htm shim failed', e); }
        })();
    </script>
    <script src="src/common.js"></script>
    
    <!-- CORE DONT TOUCH-->
    <script src="src/core/app-registry.js"></script>
    <script src="src/core/config-manager.js"></script>
    <script src="src/core/keybinds-manager.js"></script>
    <script src="src/core/KernelShim.js"></script>
    <script src="src/core/Kernel.js"></script>
    <script src="src/core/launcher.js"></script>
    <script src="src/core/notification-manager.js"></script>
    <script src="src/core/screensaver-manager.js"></script>
    <script src="src/core/performance-manager.js"></script>
    <script src="src/core/performance-adapter.js"></script>
    
    <!-- STAY STABLE PLEASE Modules -->
    <script src="src/utils/persistence.js"></script>
    <script src="src/utils/time.js"></script>
    <script src="src/utils/date.js"></script>    
    <!-- Apps for pc -->
    <script src="src/apps/settings.js"></script>
    <script src="src/apps/notes.js"></script>
    <script>
    // UserAppRenderer: SCRAPED CRAP
    window.UserAppRenderer = function UserAppRenderer({ appId }) {
        const { html, useState, useEffect } = window;
        const userId = appId.replace('USERAPP_', '');
        const [app, setApp] = useState(null);
        useEffect(() => {
            try {
                const apps = JSON.parse(localStorage.getItem('appb.userapps')) || [];
                setApp(apps.find(a => String(a.id) === String(userId)));
            } catch { setApp(null); }
        }, [appId]);
        if (!app) return html`<div style="padding:24px;">App not found.</div>`;
        const renderBlock = (block) => {
            switch (block.type) {
                case 'button':
                    return html`<button style="font-size:16px;padding:8px 18px;margin:6px;" onclick=${() => alert('Button pressed!')}>${block.text}</button>`;
                case 'text':
                    return html`<span style="font:${block.font};color:${block.color};margin:6px;">${block.text}</span>`;
                case 'space':
                    return html`<div style="height:${block.height}px;"></div>`;
                case 'input':
                    return html`<input placeholder=${block.placeholder} style="margin:6px;padding:6px 10px;border-radius:6px;border:1px solid #ccc;" />`;
                case 'tab':
                    return html`<div style="margin:6px;"><div style="display:flex;gap:8px;">${block.tabs.map(tab => html`<button style="padding:6px 14px;border-radius:6px;">${tab}</button>`)}</div></div>`;
                default:
                    return html`<div>Unknown block</div>`;
            }
        };
        return html`<div style="padding:24px;"><h3 style="margin-bottom:18px;">${app.name}</h3>${app.blocks.map(renderBlock)}</div>`;
    };
    </script>
    <script src="src/apps/calendar.js"></script>
    <script src="src/apps/clock.js"></script>
    <script src="src/apps/file-manager.js"></script>
    <script src="src/apps/camera.js"></script>
    <script src="src/apps/image-editor.js"></script>
    <script src="src/apps/gallery.js"></script>
    <script src="src/apps/AppLauncher.js"></script>

</head>
<body>
    <script>
        // Dumb crap to keep the system from freaking out
        (function(){
            try{
                const dump = Array.from(document.body.childNodes).map(n => {
                    return { nodeName: n.nodeName, nodeType: n.nodeType, text: n.nodeType === Node.TEXT_NODE ? (n.textContent || '').trim() : undefined };
                });
                console.warn('GLEX early body dump:', dump);
                try { console.warn('GLEX early body innerHTML snapshot (first 2k chars):', document.body.innerHTML.slice(0,2048)); } catch(e) {}
            }catch(e){ console.error('GLEX early diagnostic failed', e); }
        })();
    </script>
    <div id="root"></div>
    <div id="notification-container" role="status" aria-live="polite" aria-label="System notifications"></div>
    <script src="src/script.js"></script>
</body>
</html>

